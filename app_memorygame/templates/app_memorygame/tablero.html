{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Tablero - MemoryGame</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- CSS personalizado -->
  <link rel="stylesheet" href="{% static 'app_memorygame/css/estilos.css' %}">
</head>


<body data-resultado="{{ resultado|default:'' }}">
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
    <div class="container">
      <a></a>
      <div class="d-flex gap-2">
        <a href="{% url 'menu' %}" class="btn btn-outline-secondary btn-sm">Volver al Menú</a>
      </div>
    </div>
  </nav>

  <div class="container py-4">

    <!-- Título del juego -->
    <h2 class="text-center mb-4">MEMORY GAME - NIVEL {{ juego.level|default:"Básico" }}</h2>

    <!-- Información del usuario y estadísticas básicas -->
    <div class="d-flex justify-content-center gap-5 align-items-start">
      <div>
        <strong>JUGADOR:</strong> {{ request.user.username }}
      </div>
      <div>
        <strong>PUNTAJE:</strong> <span id="puntos">{{ juego.score|default:"0" }}</span> &nbsp;&nbsp;
        <strong>INTENTOS:</strong> <span id="intentos">{{ juego.attempts|default:"0" }}</span> &nbsp;&nbsp;
        <strong>VIDAS:</strong> <span id="vidas">{{ vidas_restantes|default:"0" }}</span>&nbsp;&nbsp;
        <strong>TIEMPO RESTANTE:</strong> <span id="timer">{{ tiempo_total }}</span> SEGUNDOS
      </div>
      <form id="resultado-form" method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="status" id="input-status" value="">
        <input type="hidden" name="attempts" id="input-attempts" value="">
        <input type="hidden" name="score" id="input-score" value="">
      </form>

    </div>

    <!-- Tablero de cartas -->
    <div id="tablero-grid" class="d-grid gap-3 mx-auto"
      style="grid-template-columns: repeat(4, 1fr); width: fit-content;">
      {% for carta in cartas %}
      <div class="col text-center">
        <div class="memory-card" data-id="{{ carta.value }}" tabindex="0">
          <div class="front-face">
            <img src="{{ carta.image_url }}" alt="Carta {{ carta.name }}" class="img-fluid"
              style="border-radius: 10px; max-width: 100px;">
          </div>
          <div class="back-face">
            ?
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

  </div>

  <!-- Modal de pérdida -->
  <div class="modal fade" id="modalPerdiste" tabindex="-1" aria-labelledby="modalPerdisteLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center">
        <div class="modal-header">
          <h5 class="modal-title" id="modalPerdisteLabel">¡DERROTA!</h5>
        </div>
        <div class="modal-body">
          SUERTE LA PRÓXIMA.
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" id="btnVolverMenu" class="btn btn-primary">Volver al Menú</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de victoria -->
  <div class="modal fade" id="modalVictoria" tabindex="-1" aria-labelledby="modalVictoriaLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center">
        <div class="modal-header">
          <h5 class="modal-title" id="modalVictoriaLabel">¡VICTORIA!</h5>
        </div>
        <div class="modal-body">
          HAS COMPLETADO EL JUEGO EXITOSAMENTE.
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" id="btnVolverMenuVictoria" class="btn btn-success">Volver al Menú</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Confirmar Salida -->
  <div class="modal fade" id="modalConfirmarSalida" tabindex="-1" aria-labelledby="modalConfirmarSalidaLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center">
        <div class="modal-header">
          <h5 class="modal-title" id="modalConfirmarSalidaLabel">¿Seguro que quieres salir?</h5>
        </div>
        <div class="modal-body">
          Si sales ahora, la partida contará como derrota.
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" id="btnCancelarSalida" class="btn btn-secondary"
            data-bs-dismiss="modal">Cancelar</button>
          <button type="button" id="btnConfirmarSalida" class="btn btn-danger">Salir y Perder</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS  -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Aquí el script para la lógica y animaciones -->
  <script src="{% static 'app_memorygame/js/juego.js' %}"></script>

  <audio id="bg-music" autoplay loop>
    {% if juego.level == 'B' %}
    <source src="{% static 'app_memorygame/sonidos/facil.mp3' %}" type="audio/mpeg">
    {% elif juego.level == 'M' %}
    <source src="{% static 'app_memorygame/sonidos/medio.mp3' %}" type="audio/mpeg">
    {% elif juego.level == 'A' %}
    <source src="{% static 'app_memorygame/sonidos/avanzado.mp3' %}" type="audio/mpeg">
    {% endif %}
  </audio>


</body>

</html>